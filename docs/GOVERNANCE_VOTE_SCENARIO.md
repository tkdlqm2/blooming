# 거버넌스 투표 시나리오 스크립트 가이드

## 📋 개요

`governance_vote_scenario.sh` 스크립트는 블록체인 기반 거버넌스 시스템의 전체 투표 시나리오를 자동화하여 테스트하는 도구입니다. 사용자 생성부터 투표 완료까지의 전체 과정을 시뮬레이션합니다.

## 🎯 주요 기능

- **대화형 설정**: 콘솔 입력을 통한 사용자 수 및 투표 비율 설정
- **자동 사용자 생성**: 지정된 수만큼의 테스트 사용자 자동 생성
- **포인트-토큰 교환**: 무료 포인트 지급 및 ERC-20 토큰 교환
- **거버넌스 제안**: 블록체인 기반 거버넌스 제안 생성 및 브로드캐스트
- **투표 시뮬레이션**: 찬성/반대/기권 투표 자동 실행
- **실시간 로깅**: 각 단계별 상세한 진행 상황 및 트랜잭션 해시 출력

## �� 실행 방법

### 1. 사전 준비

```bash
# 스크립트 실행 권한 부여
chmod +x scripts/governance_vote_scenario.sh

# 애플리케이션 실행 (포트 8081)
./gradlew bootRun
```

### 2. 스크립트 실행

```bash
# 스크립트 실행
./scripts/governance_vote_scenario.sh
```

### 3. 대화형 설정

스크립트 실행 시 다음 정보를 순서대로 입력합니다:

```
생성할 사용자 수를 입력하세요 (10명 이하): 5
찬성 투표 수를 입력하세요: 3
반대 투표 수를 입력하세요: 1
기권 투표 수를 입력하세요: 1
거버넌스 안건 제안을 입력하세요: 새로운 기능 추가 제안
거버넌스 안건 설명을 입력하세요: 사용자 경험 개선을 위한 새로운 기능을 추가합니다.
```

##  시나리오 플로우

### 1단계: 사용자 생성
- 지정된 수만큼의 테스트 사용자 생성
- 각 사용자별 고유 ID 및 JWT 토큰 발급
- 사용자 정보를 배열에 저장

### 2단계: user1 초기 설정
- **무료 포인트 지급**: 200,000 포인트
- **이더리움 지갑 생성**: Sepolia 테스트넷 지갑
- **ERC-20 토큰 교환**: 101,000 포인트 → ERC-20 토큰
- **Delegate 진행**: 20초 대기 (블록체인 동기화)

### 3단계: 거버넌스 제안 생성
- **제안 정보 설정**:
  - 제목 및 설명 (사용자 입력)
  - 투표 시작/종료 시간 (자동 계산)
  - 필요 정족수: 100
  - 제안 수수료: 10.00 ETH
- **제안 저장**: 데이터베이스에 제안 정보 저장

### 4단계: 수수료 충전
- **이더리움 수수료 충전**: user1 지갑에 10.00 ETH 충전
- **30초 대기**: 블록체인 트랜잭션 처리 대기

### 5단계: 제안 브로드캐스트
- **블록체인 브로드캐스트**: 거버넌스 컨트랙트에 제안 등록
- **트랜잭션 해시 저장**: 추적을 위한 해시 저장

### 6단계: 나머지 사용자 설정
- **순차 처리**: user2부터 userN까지
- **포인트-토큰 교환**: 각 사용자별 ERC-20 토큰 획득
- **수수료 충전**: 투표를 위한 이더리움 충전

### 7단계: 투표 실행
- **1분 대기**: 거버넌스 시작 시간 동기화
- **제안 상태 확인**: DRAFT → ACTIVE → VOTING
- **투표 실행**: 설정된 비율에 따른 찬성/반대/기권 투표

## 🔧 설정 변수

### 기본 설정
```bash
BASE_URL="http://localhost:8081"        # API 서버 주소
POINT_AMOUNT=200000                      # 무료 포인트 지급량
EXCHANGE_AMOUNT=101000                   # ERC-20 교환 포인트량
PROPOSAL_FEE=10.00                       # 제안 수수료 (ETH)
```

### 투표 설정
- **사용자 수**: 1-10명 (입력값)
- **찬성 투표**: 0-사용자수 (입력값)
- **반대 투표**: 0-사용자수 (입력값)
- **기권 투표**: 0-사용자수 (입력값)

##  로그 시스템

### 로그 레벨
- `[INFO]`: 일반 정보
- `[SUCCESS]`: 성공 메시지
- `[WARNING]`: 경고 메시지
- `[ERROR]`: 오류 메시지
- `[TRANSACTION]`: 트랜잭션 해시
- `[DELEGATE]`: 위임 진행 상황

### 색상 코드
- 🔵 **파란색**: 정보
- 🟢 **초록색**: 성공
- 🟡 **노란색**: 경고
- 🔴 **빨간색**: 오류
-  **청록색**: 트랜잭션
-  **보라색**: 위임

## ⚠️ 주의사항

### 1. 이더리움 잔액
- **필요 잔액**: 각 사용자 지갑에 최소 0.01 ETH 필요
- **Sepolia Faucet**: [sepoliafaucet.com](https://sepoliafaucet.com/)에서 테스트넷 ETH 획득
- **가스비**: 투표당 약 0.003 ETH 소모

### 2. 네트워크 설정
- **테스트넷**: Ethereum Sepolia (Chain ID: 11155111)
- **컨트랙트 주소**:
  - 거버넌스: `0x4E5EE91796498E843a7Ae952BC86B1a1547C60bB`
  - ERC-20: `0xd2Dfe16C1F31493530D297D58E32c337fd27615D`

### 3. 타이밍 고려사항
- **Delegate 대기**: 20초 (블록체인 동기화)
- **수수료 충전 대기**: 30초 (트랜잭션 처리)
- **투표 시작 대기**: 1분 (거버넌스 시작 시간)

##  문제 해결

### 일반적인 오류

#### 1. 포트 충돌
```bash
# 포트 8081 사용 중인 프로세스 확인
lsof -i :8081

# 프로세스 종료
kill -9 <PID>
```

#### 2. 이더리움 잔액 부족
```
insufficient funds for gas * price + value: have 0 want 3000000000000000
```
**해결**: Sepolia Faucet에서 테스트넷 ETH 충전

#### 3. JSON 인코딩 오류
```
JSON parse error: Invalid UTF-8 start byte 0x9d
```
**해결**: 스크립트에서 UTF-8 인코딩 설정 확인

### 디버깅 방법

#### 1. 로그 확인
```bash
# 애플리케이션 로그 확인
tail -f logs/application.log
```

#### 2. API 응답 확인
```bash
# 특정 API 엔드포인트 테스트
curl -X GET "http://localhost:8081/api/governance/proposals/{proposalId}"
```

#### 3. 블록체인 상태 확인
```bash
# 트랜잭션 상태 확인
curl -X GET "http://localhost:8081/api/blockchain/ethereum/transaction?txHash={hash}"
```

## 📈 성능 최적화

### 1. 배치 처리
- 사용자 생성 및 설정을 병렬 처리로 최적화 가능
- 투표 실행 시 배치 단위로 처리

### 2. 메모리 관리
- 대량 사용자 생성 시 메모리 사용량 모니터링
- 임시 파일 자동 정리

### 3. 네트워크 최적화
- API 호출 간격 조정
- 재시도 로직 구현

## 🔄 확장 가능성

### 1. 추가 네트워크 지원
- Solana 네트워크 지원 추가
- 멀티체인 거버넌스 테스트

### 2. 고급 시나리오
- 복잡한 투표 규칙 테스트
- 토큰 스테이킹 시나리오
- 위임 투표 시나리오

### 3. 모니터링 및 알림
- 실시간 진행 상황 모니터링
- 이메일/Slack 알림 기능

## 📚 관련 문서

- [API 문서](./API.md)
- [아키텍처 가이드](./ARCHITECTURE.md)
- [블록체인 메타데이터 가이드](./BLOCKCHAIN_METADATA_GUIDE.md)
- [데이터베이스 가이드](./DATABASE.md)

##  기여하기

스크립트 개선이나 버그 리포트는 이슈를 통해 제출해주세요.

---

**마지막 업데이트**: 2025-01-24
**버전**: 1.0.0
**작성자**: Governance Team 